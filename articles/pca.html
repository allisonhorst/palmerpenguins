<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PCA with penguins and recipes • palmerpenguins</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="PCA with penguins and recipes">
<meta property="og:description" content="palmerpenguins">
<meta property="og:image" content="https://allisonhorst.github.io/palmerpenguins/reference/figures/palmerpenguins.png">
<meta property="og:image:alt" content="palmerpenguins data package in R">
<meta name="twitter:card" content="summary">
<meta name="twitter:creator" content="@allison_horst">
<meta name="twitter:site" content="@allison_horst">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-169202294-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-169202294-1');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">palmerpenguins</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/palmerpenguins.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-header">Use palmerpenguins</li>
    <li>
      <a href="../articles/examples.html">Examples using ggplot2</a>
    </li>
    <li>
      <a href="../articles/pca.html">PCA example</a>
    </li>
    <li>
      <a href="../articles/user_contributions.html">Community examples</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Extras</li>
    <li>
      <a href="../articles/art.html">Art</a>
    </li>
    <li>
      <a href="../articles/download.html">Download the data directly</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/allisonhorst/palmerpenguins/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="pca_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>PCA with penguins and recipes</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/allisonhorst/palmerpenguins/blob/master/vignettes/pca.Rmd"><code>vignettes/pca.Rmd</code></a></small>
      <div class="hidden name"><code>pca.Rmd</code></div>

    </div>

    
    
<p>You’ll need these packages to follow along with the code in this article locally:</p>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://allisonhorst.github.io/palmerpenguins">palmerpenguins</a></span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw">corrr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw">GGally</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://github.com/tidymodels/recipes">recipes</a></span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw">tidytext</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://dplyr.tidyverse.org">dplyr</a></span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://tidyr.tidyverse.org">tidyr</a></span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="http://ggplot2.tidyverse.org">ggplot2</a></span>)
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html">theme_set</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span>())
</pre></div>
<div id="correlation-matrix" class="section level2">
<h2 class="hasAnchor">
<a href="#correlation-matrix" class="anchor"></a>Correlation matrix</h2>
<p>The <code><a href="../reference/penguins.html">palmerpenguins::penguins</a></code> data contains several size measurement variables that are correlated. Let’s take a look at the correlation matrix with the <a href="https://corrr.tidymodels.org/">corrr package</a> and the <code>corrr::correlate()</code> function:</p>
<div class="sourceCode" id="cb2"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw">corrr</span>)
<span class="kw">penguins_corr</span> <span class="op">&lt;-</span> <span class="kw">penguins</span> <span class="op">%&gt;%</span>
  <span class="kw">dplyr</span>::<span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="fu">where</span>(<span class="kw">is.numeric</span>)) <span class="op">%&gt;%</span>
  <span class="fu">correlate</span>() <span class="op">%&gt;%</span>
  <span class="fu">rearrange</span>()
<span class="kw">penguins_corr</span>
</pre></div>
<pre><code>#&gt; # A tibble: 4 x 5
#&gt;   rowname           flipper_length_mm body_mass_g bill_length_mm bill_depth_mm
#&gt;   &lt;chr&gt;                         &lt;dbl&gt;       &lt;dbl&gt;          &lt;dbl&gt;         &lt;dbl&gt;
#&gt; 1 flipper_length_mm            NA           0.871          0.656        -0.584
#&gt; 2 body_mass_g                   0.871      NA              0.595        -0.472
#&gt; 3 bill_length_mm                0.656       0.595         NA            -0.235
#&gt; 4 bill_depth_mm                -0.584      -0.472         -0.235        NA  </code></pre>
<p>Body mass and flipper length appear highly correlated, but neither of the bill variables appears to be as highly correlated with any other variables.</p>
</div>
<div id="pairwise-plot-matrix" class="section level2">
<h2 class="hasAnchor">
<a href="#pairwise-plot-matrix" class="anchor"></a>Pairwise plot matrix</h2>
<p>We can visualize these correlations with the <a href="https://ggobi.github.io/ggally/">GGally package</a>. The function we’ll use is called <a href="https://ggobi.github.io/ggally/articles/ggpairs.html"><code>GGally::ggpairs()</code></a>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit">
<span class="kw">penguins</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="kw">species</span>, <span class="fu">where</span>(<span class="kw">is.numeric</span>)) <span class="op">%&gt;%</span> 
  <span class="kw">GGally</span>::<span class="fu">ggpairs</span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(color = <span class="kw">species</span>),
          columns = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"flipper_length_mm"</span>, <span class="st">"body_mass_g"</span>, 
                      <span class="st">"bill_length_mm"</span>, <span class="st">"bill_depth_mm"</span>)) <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_colour_manual</a></span>(values = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"darkorange"</span>,<span class="st">"purple"</span>,<span class="st">"cyan4"</span>)) <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span>(values = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"darkorange"</span>,<span class="st">"purple"</span>,<span class="st">"cyan4"</span>))
</pre></div>
<p><img src="figs/penguin-pairs.png" width="100%"></p>
</div>
<div id="principal-component-analysis-pca" class="section level2">
<h2 class="hasAnchor">
<a href="#principal-component-analysis-pca" class="anchor"></a>Principal component analysis (PCA)</h2>
<p>We’ll use the <a href="https://recipes.tidymodels.org">recipes</a> package from <a href="https://www.tidymodels.org">tidymodels</a> to perform a <a href="https://en.wikipedia.org/wiki/Principal_component_analysis">principal component analysis (PCA)</a>.</p>
<p>First, we’ll also use a few recipe steps to preprocess the data for PCA; namely, we need to:</p>
<ul>
<li>remove any <code>NA</code> values,</li>
<li>center all predictors, and</li>
<li>scale all predictors.</li>
</ul>
<p>If you’ve never used the recipes package before, try <a href="https://www.tidymodels.org/start/recipes/">this article</a> to get started.</p>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://github.com/tidymodels/recipes">recipes</a></span>)
<span class="kw">penguin_recipe</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="https://recipes.tidymodels.org/reference/recipe.html">recipe</a></span>(<span class="op">~</span><span class="kw">.</span>, data = <span class="kw">penguins</span>) <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://recipes.tidymodels.org/reference/roles.html">update_role</a></span>(<span class="kw">species</span>, <span class="kw">island</span>, <span class="kw">sex</span>, new_role = <span class="st">"id"</span>) <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_naomit.html">step_naomit</a></span>(<span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html">all_predictors</a></span>()) <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_normalize.html">step_normalize</a></span>(<span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html">all_predictors</a></span>()) <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_pca.html">step_pca</a></span>(<span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html">all_predictors</a></span>(), id = <span class="st">"pca"</span>) <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://recipes.tidymodels.org/reference/prep.html">prep</a></span>()

<span class="kw">penguin_pca</span> <span class="op">&lt;-</span> 
  <span class="kw">penguin_recipe</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/generics/man/tidy.html">tidy</a></span>(id = <span class="st">"pca"</span>) 

<span class="kw">penguin_pca</span>
</pre></div>
<pre><code>#&gt; # A tibble: 16 x 4
#&gt;    terms                value component id   
#&gt;    &lt;chr&gt;                &lt;dbl&gt; &lt;chr&gt;     &lt;chr&gt;
#&gt;  1 bill_length_mm     0.455   PC1       pca  
#&gt;  2 bill_depth_mm     -0.400   PC1       pca  
#&gt;  3 flipper_length_mm  0.576   PC1       pca  
#&gt;  4 body_mass_g        0.548   PC1       pca  
#&gt;  5 bill_length_mm    -0.597   PC2       pca  
#&gt;  6 bill_depth_mm     -0.798   PC2       pca  
#&gt;  7 flipper_length_mm -0.00228 PC2       pca  
#&gt;  8 body_mass_g       -0.0844  PC2       pca  
#&gt;  9 bill_length_mm    -0.644   PC3       pca  
#&gt; 10 bill_depth_mm      0.418   PC3       pca  
#&gt; 11 flipper_length_mm  0.232   PC3       pca  
#&gt; 12 body_mass_g        0.597   PC3       pca  
#&gt; 13 bill_length_mm     0.146   PC4       pca  
#&gt; 14 bill_depth_mm     -0.168   PC4       pca  
#&gt; 15 flipper_length_mm -0.784   PC4       pca  
#&gt; 16 body_mass_g        0.580   PC4       pca</code></pre>
<p>The <code>value</code> column here is the loading. For each component, the <code>value</code> tells us the linear combination of weights for each variable that contributes to that component.</p>
<p>This output is a tidy version of this using <code><a href="https://rdrr.io/r/stats/prcomp.html">stats::prcomp()</a></code>:</p>
<div class="sourceCode" id="cb7"><pre class="downlit">
<span class="kw">penguins</span> <span class="op">%&gt;%</span> 
  <span class="kw">dplyr</span>::<span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="fu">where</span>(<span class="kw">is.numeric</span>)) <span class="op">%&gt;%</span> 
  <span class="kw">tidyr</span>::<span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na</a></span>() <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span>() <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html">prcomp</a></span>() <span class="op">%&gt;%</span>  
  <span class="kw">.</span><span class="op">$</span><span class="kw">rotation</span>
</pre></div>
<pre><code>#&gt;                          PC1          PC2        PC3        PC4
#&gt; bill_length_mm     0.4552503 -0.597031143 -0.6443012  0.1455231
#&gt; bill_depth_mm     -0.4003347 -0.797766572  0.4184272 -0.1679860
#&gt; flipper_length_mm  0.5760133 -0.002282201  0.2320840 -0.7837987
#&gt; body_mass_g        0.5483502 -0.084362920  0.5966001  0.5798821</code></pre>
<p>We can also apply the <code><a href="https://rdrr.io/pkg/generics/man/tidy.html">recipes::tidy()</a></code> method to the output from <code><a href="https://recipes.tidymodels.org/reference/step_pca.html">recipes::step_pca()</a></code> to examine how much variance each component accounts for:</p>
<div class="sourceCode" id="cb9"><pre class="downlit">
<span class="kw">penguin_recipe</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/generics/man/tidy.html">tidy</a></span>(id = <span class="st">"pca"</span>, type = <span class="st">"variance"</span>) <span class="op">%&gt;%</span> 
  <span class="kw">dplyr</span>::<span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="kw">terms</span> <span class="op">==</span> <span class="st">"percent variance"</span>) <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(x = <span class="kw">component</span>, y = <span class="kw">value</span>)) <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span>(fill = <span class="st">"#b6dfe2"</span>) <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">xlim</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">5</span>)) <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span>(<span class="st">"% of total variance"</span>)
</pre></div>
<p><img src="pca_files/figure-html/unnamed-chunk-4-1.png" width="100%"></p>
</div>
<div id="plot-pca-loadings" class="section level2">
<h2 class="hasAnchor">
<a href="#plot-pca-loadings" class="anchor"></a>Plot PCA loadings</h2>
<p>We can plot these loadings by principal component too, following <a href="https://juliasilge.com/blog/cocktail-recipes-umap/">Julia Silge’s example</a>:</p>
<div class="sourceCode" id="cb10"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="http://ggplot2.tidyverse.org">ggplot2</a></span>)
<span class="kw">penguin_pca</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(terms = <span class="kw">tidytext</span>::<span class="fu">reorder_within</span>(<span class="kw">terms</span>, 
                                          <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span>(<span class="kw">value</span>), 
                                          <span class="kw">component</span>)) <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span>(<span class="kw">value</span>), <span class="kw">terms</span>, fill = <span class="kw">value</span> <span class="op">&gt;</span> <span class="fl">0</span>)) <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span>() <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span>(<span class="op">~</span><span class="kw">component</span>, scales = <span class="st">"free_y"</span>) <span class="op">+</span>
  <span class="kw">tidytext</span>::<span class="fu">scale_y_reordered</span>() <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span>(values = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"#b6dfe2"</span>, <span class="st">"#0A537D"</span>)) <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(
    x = <span class="st">"Absolute value of contribution"</span>,
    y = <span class="kw">NULL</span>, fill = <span class="st">"Positive?"</span>
  ) 
</pre></div>
<p><img src="figs/pca-loadings-plot.png" width="100%"></p>
</div>
<div id="plot-pca-loadings-scores" class="section level2">
<h2 class="hasAnchor">
<a href="#plot-pca-loadings-scores" class="anchor"></a>Plot PCA loadings + scores</h2>
<p>We have the PCA loadings in <code>penguin_pca</code>. But we need them in a wide format now for plotting.</p>
<div class="sourceCode" id="cb11"><pre class="downlit">
<span class="co"># get pca loadings into wider format</span>
<span class="kw">pca_wider</span> <span class="op">&lt;-</span> <span class="kw">penguin_pca</span> <span class="op">%&gt;%</span> 
  <span class="kw">tidyr</span>::<span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span>(names_from = <span class="kw">component</span>, id_cols = <span class="kw">terms</span>)
</pre></div>
<p>We also need to go back to our prepped penguin recipe, <code>prepped_penguins</code>, and <code><a href="https://recipes.tidymodels.org/reference/juice.html">recipes::juice()</a></code> it to get the PCA scores back.</p>
<div class="sourceCode" id="cb12"><pre class="downlit">
<span class="co"># define arrow style</span>
<span class="kw">arrow_style</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grid/arrow.html">arrow</a></span>(length = <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span>(<span class="fl">.05</span>, <span class="st">"inches"</span>),
                     type = <span class="st">"closed"</span>)


<span class="kw">pca_plot</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="https://recipes.tidymodels.org/reference/juice.html">juice</a></span>(<span class="kw">penguin_recipe</span>) <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">PC1</span>, <span class="kw">PC2</span>)) <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(color = <span class="kw">species</span>, shape = <span class="kw">species</span>), 
             alpha = <span class="fl">0.8</span>, 
             size = <span class="fl">2</span>) <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_colour_manual</a></span>(values = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"darkorange"</span>,<span class="st">"purple"</span>,<span class="st">"cyan4"</span>)) 

<span class="kw">pca_plot</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment</a></span>(data = <span class="kw">pca_wider</span>,
               <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(xend = <span class="kw">PC1</span>, yend = <span class="kw">PC2</span>), 
               x = <span class="fl">0</span>, 
               y = <span class="fl">0</span>, 
               arrow = <span class="kw">arrow_style</span>) <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span>(data = <span class="kw">pca_wider</span>,
            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(x = <span class="kw">PC1</span>, y = <span class="kw">PC2</span>, label = <span class="kw">terms</span>), 
            hjust = <span class="fl">0</span>, 
            vjust = <span class="fl">1</span>,
            size = <span class="fl">5</span>, 
            color = <span class="st">'#0A537D'</span>) 
</pre></div>
<p><img src="pca_files/figure-html/pc1-2-plot-1.png" width="100%"></p>
<p>In the above plot, you can see a lot!</p>
<p>First, if you focus on the x-axis showing us the first principal component, you can see that flipper length and body mass are very important (confirming what we saw in the above bar chart). Along this dimension, Gentoo penguins stand out clearly from the other two species. We can confirm this looking at summary statistics:</p>
<div class="sourceCode" id="cb13"><pre class="downlit">
<span class="kw">penguins</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(<span class="kw">species</span>) <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span>(<span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">flipper_length_mm</span>, <span class="kw">body_mass_g</span>), 
                   <span class="kw">mean</span>, 
                   na.rm = <span class="fl">TRUE</span>)) 
</pre></div>
<pre><code>#&gt; # A tibble: 3 x 3
#&gt;   species   flipper_length_mm body_mass_g
#&gt;   &lt;fct&gt;                 &lt;dbl&gt;       &lt;dbl&gt;
#&gt; 1 Adelie                 190.       3701.
#&gt; 2 Chinstrap              196.       3733.
#&gt; 3 Gentoo                 217.       5076.</code></pre>
<p>We can see this with a simple scatterplot:</p>
<div class="sourceCode" id="cb15"><pre class="downlit">
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="kw">penguins</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(x = <span class="kw">flipper_length_mm</span>, y = <span class="kw">body_mass_g</span>, colour = <span class="kw">species</span>)) <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>() <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_colour_manual</a></span>(values = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"darkorange"</span>,<span class="st">"purple"</span>,<span class="st">"cyan4"</span>)) 
</pre></div>
<p><img src="pca_files/figure-html/flipper-mass-plot-1.png" width="100%"></p>
<p>If you now focus more on the y-axis showing us the second principal component, you can see that our two bill size variables, <code>bill_length_mm</code> and <code>bill_depth_mm</code>, are very important (again, confirming what we saw in the above bar chart).</p>
<p>Let’s do the same thing for principal component 2 and 3.</p>
<div class="sourceCode" id="cb16"><pre class="downlit">
<span class="kw">pca_plot</span> <span class="op">%+%</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">PC2</span>, <span class="kw">PC3</span>) <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment</a></span>(data = <span class="kw">pca_wider</span>,
               <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(xend = <span class="kw">PC2</span>, yend = <span class="kw">PC3</span>), 
               x = <span class="fl">0</span>, 
               y = <span class="fl">0</span>, 
               arrow = <span class="kw">arrow_style</span>) <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span>(data = <span class="kw">pca_wider</span>,
            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(x = <span class="kw">PC2</span>, y = <span class="kw">PC3</span>, label = <span class="kw">terms</span>), 
            hjust = <span class="fl">0</span>, 
            vjust = <span class="fl">1</span>,
            size = <span class="fl">5</span>, 
            color = <span class="st">'#0A537D'</span>) 
</pre></div>
<p><img src="pca_files/figure-html/unnamed-chunk-8-1.png" width="100%"></p>
<p>We see again that PC2 seems most associated with our bill size variables, <code>bill_length_mm</code> and <code>bill_depth_mm</code>. But now we can see more clearly that this dimension seems to separate Chinstrap penguins from the other two species. We can confirm this by glancing at summary statistics again by species:</p>
<div class="sourceCode" id="cb17"><pre class="downlit">
<span class="kw">penguins</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(<span class="kw">species</span>) <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span>(<span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">bill_depth_mm</span>, <span class="kw">bill_length_mm</span>), 
                   <span class="kw">mean</span>, 
                   na.rm = <span class="fl">TRUE</span>))
</pre></div>
<pre><code>#&gt; # A tibble: 3 x 3
#&gt;   species   bill_depth_mm bill_length_mm
#&gt;   &lt;fct&gt;             &lt;dbl&gt;          &lt;dbl&gt;
#&gt; 1 Adelie             18.3           38.8
#&gt; 2 Chinstrap          18.4           48.8
#&gt; 3 Gentoo             15.0           47.5</code></pre>
<p>We can see this with a simple scatterplot too:</p>
<div class="sourceCode" id="cb19"><pre class="downlit">
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="kw">penguins</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(x = <span class="kw">bill_length_mm</span>, y = <span class="kw">bill_depth_mm</span>, colour = <span class="kw">species</span>)) <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>() <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_colour_manual</a></span>(values = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"darkorange"</span>,<span class="st">"purple"</span>,<span class="st">"cyan4"</span>)) 
</pre></div>
<p><img src="pca_files/figure-html/unnamed-chunk-10-1.png" width="100%"></p>
<p>This is actually a pretty neat scatterplot—it highlights a perfect example of why you’d need the combination of two variables to differentiate between these three species. Comparing distributions for any single variable only differentiates one species from the other two!<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a></p>
<p><img src="pca_files/figure-html/unnamed-chunk-11-1.png" width="49%"><img src="pca_files/figure-html/unnamed-chunk-11-2.png" width="49%"></p>
</div>
<div id="summary" class="section level2">
<h2 class="hasAnchor">
<a href="#summary" class="anchor"></a>Summary</h2>
<p>So, Gentoos appear to just be giants, compared to the Adelie and Chinstrap penguins. While Adelie and Chinstraps are similar size-wise as measured by flipper length and body mass, Chinstraps seem to have longer bills and Adelie penguins have stubbier bills (a pug-gein, if you will?). And Gentoos, despite being large overall, have flatter bills than either of the other two species. Reminder:</p>
<p><img src="../reference/figures/culmen_depth.png" width="40%"></p>
</div>
<div id="other-pca-resources" class="section level2">
<h2 class="hasAnchor">
<a href="#other-pca-resources" class="anchor"></a>Other PCA resources</h2>
<ul>
<li>Michael Friendly’s <a href="https://rpubs.com/friendly/penguin-biplots">multivariate palmerpenguins analysis</a>
</li>
<li>Julia Silge’s <a href="https://juliasilge.com/blog/cocktail-recipes-umap/">PCA and UMAP with tidymodels and #TidyTuesday cocktail recipes</a>
</li>
</ul>
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p>this is also a great example Simpson’s paradox, see <code><a href="../articles/examples.html">vignette("examples")</a></code><a href="#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://www.allisonhorst.com/">Allison Horst</a>, <a href="https://alison.rbind.io">Alison Hill</a>, <a href="https://www.uaf.edu/cfos/people/faculty/detail/kristen-gorman.php">Kristen Gorman</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.9000.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
